---
title: "tag_data_inventory"
author: "Lauren Fritz"
date: "2026-02-01"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

What years exist? - 16 DTAG deployments: 2009-2010 - 72 CATS tag
deployments: 2016-2025

Where does the dataset currently live? DTAG data is still being located.
CATS tag data is on my drive, about to be consolidated today. There is a
working master spreadsheet in this repository titled
CATS_Tag_Deployments_By_Month_Year

Intended analysis for this chapter - Activity budgets - Behavioral state
classification - Time allocation by demohgraphic/season when and if
appropriate

February 19. 2026 Downloaded MATLAB update

February 20, 2026 Opened MATLAB to change
SimpleLungeDetectionBehaviorState.m code for my purposes. I created a
new file called SimpleBehaviorStateActivityBudget.m by cloning the
other, and am using ChatGPT to help me identify pieces of the code that
need to be editted to account now for four behavioral states instead of
just trying to identify foraging lunges. I also added MATLAB to the
github aka created a MATLAB project that is linked to my Activity Budget
github. It is saved on the Tag Data harddrive NAN_Backup.

February 24, 2026

Determining how to define the behavioral state bins for automatic
processing by MATLAB, to then be audited by me.

-   Foraging is obviously easiest to identify because there either is a
    lunge or there isn't. Any dive that has a lunge is foraging. Any
    dive that does not have a lunge is not foraging. But how do we
    define resting and separate that from the other non-foraging
    behavior? We can separate "routine inter-dive surfacing" from
    "extended non-foraging bouts", and then use movement and depth
    patterns inside those extended bouts to decide "resting vs.
    traveling/exploring"

-   The plan: I'm using the expert lunge audits that already exist

-   Then, building an automated pipeline. I will spot-check 10-20%
    across years/regions/tag types/individual classes

-   Targeted checks on "weird" cases flagged by quality control

Define:

-   foraging = entire dive if it contains one lunge

-   traveling = entire dive if 10-50 m max depth and no lunges

-   resting = near-surface non-dive bouts (between dives)

-   exploring = everything else (and will be further explored LOL to
    identify clusters or other behaviors that stand out so we can
    subdivide this category)

-   state switching only occurs at dive boundaries

Daily Research Summary – Behavioral State Classification Refinement
Objective

Refine automated behavioral state classification for humpback whale PRH
deployments to align with biologically grounded definitions of foraging,
traveling, resting, and exploring.

1.  Lunge Integration and Foraging Definition

Scientific decision:

Foraging dives are defined as any dive containing ≥1 expert-audited
lunge.

Use previously created lunges files (expert-reviewed) rather than
re-detecting lunges.

Entire dive labeled as “foraging” if any lunge occurs within dive
bounds.

Coding work completed:

Implemented robust lunges file selection based on time overlap with PRH
DN.

Standardized mapping from LungeDN (datenum) → PRH sample indices (LI).

Ensured lunges are clipped to tag-on interval.

Removed redundant logic that accidentally wiped LI.

Verified lunges are correctly recognized and producing \>0% foraging
time.

2.  Dive-Bounded State Logic

Scientific decision:

Behavioral state switches only occur at the beginning or end of dives.

Dive definition updated to match behavioral thresholds.

Definitions implemented:

State Definition Foraging Dive with ≥1 lunge (whole dive labeled)
Traveling Dive with max depth 10–50 m AND no lunges (whole dive labeled)
Resting Surface intervals only (0–10 m), low movement Exploring All
remaining tag-on time

Key refinement:

Adjusted dive start threshold to 10 m to align with resting band (0–10
m).

Ensured resting cannot occur within dives.

Coding work completed:

Rewrote classifier into a single clean block.

Removed legacy isForage, nonForage, and duplicate dive logic.

Ensured state is defined once and not overwritten.

Added diagnostic checks for dive detection and state assignment
consistency.

3.  Resting Definition Investigation

Scientific question: Can resting be operationalized as:

Surface interval (0–10 m),

Low movement,

Bout-based (minimum duration)?

Diagnostics revealed:

\~66,000 candidate resting samples existed.

However, resting bouts were extremely fragmented:

Median bout ≈ 0.1 s

95th percentile ≈ 0.6 s

Only 1 bout \>30 s

No bouts ≥60 s

Interpretation: Low-movement thresholding at 10 Hz produced flickering
classifications rather than sustained resting bouts.

Attempts made:

Movement smoothing (10 s window).

Gap-filling between short interruptions.

Minimum bout duration enforcement (3 min).

Resting remained effectively 0% after bout filtering, indicating that:

Either true sustained resting is rare in this deployment,

Or movement thresholding approach requires further refinement.

4.  Speed Processing Improvements

Coding improvements:

Rebuilt speedJJ using robust NaN handling and runmean.

Added fallback to speed.FN if JJ unavailable.

Added jerk proxy (J) fallback if speed unavailable.

Implemented diagnostic prints to confirm finite values in plotting
windows.

Resolved issue where speed was plotting but diagnostics were reporting
NaNs due to window selection.

5.  Structural Code Cleanup

Major structural cleanup:

Removed duplicated classifier blocks.

Eliminated legacy variables (isForage, surfaceDepth_m, etc.).

Ensured state assignment order prevents overwriting.

Preallocated variables in export sections to remove MATLAB warnings.

Added internal diagnostics to trace logical gates (surface interval,
movement threshold, bout lengths).

6.  Conceptual Progress

Today clarified:

Dive-bounded state switching logic.

Hierarchical state precedence:

Foraging (highest)

Traveling

Resting

Exploring (default)

The importance of aligning dive threshold depth with resting depth band.

The behavioral implications of movement threshold choice at high
sampling rates.

Outstanding Questions for Next Session

Is resting truly rare in this deployment, or is the movement threshold
too sensitive?

Should resting be defined relative to dive spacing (e.g., inter-foraging
intervals) instead of instantaneous movement?

Should movement be thresholded on a lower-frequency (e.g., 1 Hz)
representation rather than 10 Hz?

Is resting more appropriately defined by pitch/roll stability rather
than speed alone?

Overall Progress

Foraging and traveling classification now structurally sound and
biologically consistent.

Lunges correctly integrated and producing realistic foraging
proportions.
